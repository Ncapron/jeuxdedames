{% extends 'base.html.twig' %}

{% block body %}

    <div id="map"></div>

<!-- ******** RESEAUX ******** -->
<div id="test"></div>
    <div class="row">
        <div class="row">
            <div class="col-md-8 col-md-offset-2 reseaux">
                <h6>Vous pouvez nous retrouver</h6>
                <h2 class="h2">Sur nos différents<br/>réseaux sociaux</h2>
                <button class="btn-green">Cliquez ici</button>
            </div>
        </div>
    </div>

{% endblock %}

{% block javascripts %}

    {{ parent() }}
    <script>


        var geocoder;
        var map;


        function initMap() {
            geocoder = new google.maps.Geocoder();
            map = new google.maps.Map(document.getElementById('map'), {
                center: {lat: 48.408, lng: 2.699 },
                zoom: 14
            });
            codeAddress();
        }

       // function initialize() {

        function codeAddress() {
            var image = {
                url: 'http://www.signegeneve.ch/wp-content/themes/parallelus-salutation/assets/images/gmap-marker.png'
                // This marker is 20 pixels wide by 32 pixels high.
            };
            var image2 = {
                url: 'http://maps.google.com/mapfiles/marker_yellow.png'
                // This marker is 20 pixels wide by 32 pixels high.
            };

            {% for commercant in commercants %}
                var address = '{{ commercant.adresse }} {{ commercant.code }} {{ commercant.ville }}';
                    geocoder.geocode( { 'address': address}, function(results, status) {
                    if (status == google.maps.GeocoderStatus.OK) {
                        map.setCenter(results[0].geometry.location);
                        var marker = new google.maps.Marker({
                            map: map,
                            position: results[0].geometry.location,
                        {% if commercant.code == 77300 %}
                            icon: image,
                        {% else %}
                            icon: image2,
                        {% endif %}
                        });

                        attachDescription(marker, description);
                    } else {
                        alert("Geocode was not successful for the following reason: " + status);
                    }
                });

        }


        function attachDescription(marker, description) {

            var infowindow = new google.maps.InfoWindow({
                content: description
            });

            marker.addListener('click', function() {
                infowindow.open(marker.get('map'), marker);
            });
        }

        alert("error");
        var description =
                '<div><p>{{ commercant.adresse }}</p></div>'+
                '<div><p>{{ commercant.ville }}</p></div>'+
                '<div><p>{{ commercant.code }}</p></div>';

        alert("error");
        var marker = new google.maps.Marker({
            position: myLatLng,
            map: map,
            title: '{{ commercant.adresse }}'
        });



    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAa232Ch8q6OuI0qAkNV4s36dSJKSCaswc&callback=initMap" async defer></script>
{% endfor %}
{% endblock %}
